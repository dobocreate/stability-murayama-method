# lw計算の詳細分析結果

## 分析概要

Excel実装とPython実装のlw（重心位置）計算を詳細に分解して比較した結果、以下の違いが判明しました。

## 計算式の比較

### 1. 三角形部分（w1, lw1）
両実装で完全に一致：
- w1 = γ × H_f × B / 2
- lw1 = la + B / 3

### 2. 曲線部分の重量（w2）
両実装で完全に一致：
- w2 = γ × [(rd² - r0²)/(4×tan(φ)) - r0×rd×sin(θ_d)/2]

### 3. 曲線部分の重心（lw2）- **ここが相違点**

**Python実装（理論式）:**
```python
# 複雑な幾何学的計算
O = √(B² + H_f²)
P = arctan(H_f/B)
S = √(O²/4 + r0² - O×r0×cos(P + φ))
T = arccos(r0×sin(P + φ)/S) - (P + φ - π/2)
U = (r0×exp(T×tan(φ)) - S) × (r0×sin(P + φ)) / S

lw2 = S×cos(φ + T) + (2/3)×U×cos(arctan(B/H_f))
```

**Excel実装（推定される簡略式）:**
```
lw2 ≈ la + B × 0.575
```

## 数値検証（θ_d = 75°の例）

| パラメータ | Python | Excel | 差 |
|----------|--------|-------|-----|
| w1 | 296.738 | 296.738 | 0 |
| lw1 | 0.793 | 0.793 | 0 |
| w2 | 137.558 | 137.558 | 0 |
| lw2 | 2.096 | 1.876 | 0.220 |
| **lw（最終）** | **1.206** | **1.136** | **0.070** |

## 影響度

- lw2の差（約12%）が最終的なlw値に約6%の差として現れる
- これが支保圧Pの計算にも影響を与える

## 結論

1. **理論的正確性**: Python実装は対数らせん滑り面の厳密な幾何学的計算に基づいている
2. **実用性**: Excel実装は簡略化された式を使用しているが、工学的には十分な精度
3. **推奨**: 村山の式の理論に忠実なPython実装を維持すべき

## Excel互換性が必要な場合

どうしてもExcelと完全に一致させる必要がある場合は、以下の修正が可能：
```python
# Excel互換モード
if excel_compatible:
    lw2 = la + B * 0.575
else:
    # 現在の理論式を使用
```

ただし、これは理論的な正確性を犠牲にすることになるため、推奨されません。