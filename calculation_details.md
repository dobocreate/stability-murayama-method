# 村山の式による切羽安定性評価の詳細計算過程

## 1. 基本理論

### 1.1 対数らせん滑り面
村山の式では、切羽前方の地山に対数らせん形状の滑り面を仮定します。

対数らせん曲線の方程式：
```
r = r₀ × e^(θ × tan φ)
```

ここで：
- r: 動径（原点からの距離）[m]
- r₀: 初期半径（θ=0での半径）[m]
- θ: 偏角 [rad]
- φ: 地山の内部摩擦角 [rad]

### 1.2 モーメントのつり合い
滑り土塊に作用する力のモーメントのつり合いから必要支保圧を算出します。

```
ΣM = 0
M_W + M_Q = M_τ + M_P
```

## 2. 詳細計算過程

### 2.1 滑り土塊の面積計算

対数らせん曲線で囲まれる面積は極座標での積分により求めます。

```
A = ∫[0→θmax] (1/2) × r² dθ
  = ∫[0→θmax] (1/2) × (r₀ × e^(θ × tan φ))² dθ
  = (r₀²/2) × ∫[0→θmax] e^(2θ × tan φ) dθ
```

積分を実行すると：
```
A = (r₀²/2) × [e^(2θ × tan φ) / (2 × tan φ)]₀^θmax
  = (r₀²)/(4 × tan φ) × (e^(2θmax × tan φ) - 1)
```

### 2.2 滑り土塊の重心位置

重心のx座標は以下の積分で求めます。

```
x̄ = (1/A) × ∫∫ x dA
```

極座標では：
```
x = r × cos θ
dA = r dr dθ
```

したがって：
```
x̄ = (1/A) × ∫[0→θmax] ∫[0→r(θ)] r² × cos θ dr dθ
  = (1/A) × ∫[0→θmax] (1/3) × r³(θ) × cos θ dθ
  = (1/A) × (r₀³/3) × ∫[0→θmax] e^(3θ × tan φ) × cos θ dθ
```

### 2.3 土塊重量によるモーメント (M_W)

土塊の重量：
```
W = γ × A × 1 (単位幅)
```

重量によるモーメント：
```
M_W = W × x̄ = γ × A × x̄
```

### 2.4 上載荷重によるモーメント (M_Q)

上載荷重が作用する幅：
```
b_q = r(θmax) × cos θmax - r₀
```

上載荷重の合力：
```
Q = q × b_q × 1 (単位幅)
```

上載荷重の作用点（簡略化）：
```
x_q = b_q / 2
```

上載荷重によるモーメント：
```
M_Q = Q × x_q = q × b_q × (b_q/2)
```

### 2.5 せん断抵抗力によるモーメント (M_τ)

滑り面に沿うせん断抵抗力は、粘着力cと摩擦抵抗の和です。

微小要素での抵抗力：
```
dτ = (c + σn × tan φ) × ds
```

ここで：
- c: 粘着力 [kN/m²]
- σn: 垂直応力 [kN/m²]
- ds: 微小要素の長さ [m]

対数らせん上の微小要素の長さ：
```
ds = √(r² + (dr/dθ)²) dθ
```

対数らせんの性質から：
```
dr/dθ = r × tan φ
```

したがって：
```
ds = r × √(1 + tan²φ) dθ = r × sec φ dθ
```

せん断抵抗力によるモーメント（粘着力成分のみの簡略化）：
```
M_τ = ∫[0→θmax] c × r × ds
    = c × ∫[0→θmax] r² × sec φ dθ
    = c × r₀² × sec φ × ∫[0→θmax] e^(2θ × tan φ) dθ
```

実際の計算では、内部摩擦角の効果を考慮した補正係数を乗じます：
```
M_τ = M_τ,c × (1 + tan φ)
```

### 2.6 必要支保圧の算出

支保圧Pによるモーメント：
```
M_P = P × H × (H/2) = P × H²/2
```

モーメントのつり合いから：
```
M_W + M_Q = M_τ + M_P
```

したがって：
```
P = 2 × (M_W + M_Q - M_τ) / H²
```

## 3. パラメトリックスタディ

### 3.1 解析範囲
- r₀: r₀,min ～ r₀,max を n 分割
- θ: θmin ～ θmax を n 分割

### 3.2 最不利条件の探索
全ての(r₀, θ)の組み合わせに対して必要支保圧Pを計算し、最大値を与える条件を最不利条件とします。

```
P_max = max(P(r₀,i, θ_j)) for all i,j
```

### 3.3 安全率の評価
仮定支保圧に対する安全率：
```
FS = P_assumed / P_max
```

## 4. 数値計算上の注意点

### 4.1 積分の数値計算
本システムでは、SciPyのquad関数を使用して数値積分を実行しています。

### 4.2 収束性の確保
- 積分の分割数は自動的に調整されます
- 相対誤差は10⁻⁸以下に設定

### 4.3 物理的妥当性の確保
- 負の支保圧は0として扱います
- 極端に小さいr₀では数値誤差が生じるため、下限値を設定

## 5. 計算例

### 入力条件
- H = 10 m
- γ = 20 kN/m³
- φ = 30°
- c = 20 kN/m²
- q = 0 kN/m²

### 計算過程（r₀ = 2.0 m, θ = 30° = 0.524 rad の場合）

1. 対数らせんの終端半径：
   ```
   r = 2.0 × e^(0.524 × tan(30°)) = 2.0 × e^(0.302) = 2.71 m
   ```

2. 滑り土塊の面積：
   ```
   A = (2.0²)/(4 × tan(30°)) × (e^(2×0.524×tan(30°)) - 1)
     = 6.93 × (e^(0.605) - 1) = 6.93 × 0.831 = 5.76 m²
   ```

3. 重心位置（数値積分により）：
   ```
   x̄ ≈ 1.85 m
   ```

4. 土塊重量モーメント：
   ```
   M_W = 20 × 5.76 × 1.85 = 213.1 kN·m
   ```

5. せん断抵抗モーメント（簡略計算）：
   ```
   M_τ ≈ 180.5 kN·m
   ```

6. 必要支保圧：
   ```
   P = 2 × (213.1 + 0 - 180.5) / 10² = 0.65 kN/m²
   ```

この計算を全てのパラメータ組み合わせで実行し、最大値を求めます。