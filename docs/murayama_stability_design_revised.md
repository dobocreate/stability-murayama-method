# 村山の式を利用したトンネル切羽安定性評価 **設計書（修正版）**

> 本書は、対数らせん滑り面に基づく村山の式を用いた切羽安定性評価の**設計ロジックを正式化**したものです。
> 旧版からの主な修正点は、**幾何の閉合（r₀の内部決定）**、**支保圧の作用腕**、**粘着抵抗モーメントの閉形式**、
> **上載荷の等価合力 q の一般化（α, K の導入）**、および**有限土被り C の明示的取り扱い**です。

---

## 1. システム概要

- 滑り面形状：**対数らせん曲線** \( r = r_0\,e^{\theta \tan\phi} \)
- 釣合い：**モーメントのつり合い**にもとづいて**必要支保圧 \(P\)** を算出し、\(\theta_d\) 掃引のうち**最大 \(P\)** を臨界として採用。

---

## 2. 入出力定義（新版）

### 入力項目
- **切羽高さ** \(H\) [m]
- **単位体積重量** \(\gamma\) [kN/m³]
- **内部摩擦角** \(\phi\) [deg または rad]
- **粘着力** \(c\) [kPa]
- **土被り** \(C\) [m]（*深部前提の場合は省略可*）
- **影響幅係数** \(\alpha\)（標準：\(\alpha\simeq 1.8\) → 有効幅係数は \(\alpha/2=0.9\)）
- **経験係数** \(K\)（Terzaghi 実験：\(K=1\sim1.5\)、標準は **\(K=1\)**）
- **探索角度** \(\theta_d\) の範囲（例：\(20^\circ \sim 80^\circ\)、1°刻み）

> **注意**：**r₀ は入力しない**（幾何の閉合式から内部で決定する）。

### 出力項目
- **必要支保圧の最大値** \(P_{\max}\) とそのときの \(\theta_d^\*\)
- 臨界滑り面の幾何（\(r_0, r_d, B, l_a, l_p\) など）

---

## 3. 幾何の閉合（対数らせん）

\[
\begin{aligned}
r_0 &= \frac{H_f}{\exp(\theta_d\tan\phi)\,\sin(\phi+\theta_d)\;-\;\sin\phi},\\
r_d &= r_0\,\exp(\theta_d\tan\phi),\\
l_a &= r_d\,\cos(\phi+\theta_d),\\
B   &= r_0\cos\phi \;-\; l_a,\\
l_p &= r_0\sin\phi \;+\; \frac{H_f}{2}.
\end{aligned}
\]

- ここで \(l_p\) は**支保圧のモーメント腕**。

---

## 4. 荷重の等価合力

### 4.1 有効幅
\[
B_{\mathrm{eff}} \;=\; \frac{\alpha}{2}\,B.
\]

- 標準は \(\alpha \simeq 1.8\) よって \(B_{\mathrm{eff}}=0.9B\)。

### 4.2 上載荷の等価合力 $q$（ユーザー式採用）
\[
\boxed{\displaystyle
q \,=\, \frac{\alpha\,B\left(\gamma-\dfrac{2c}{\alpha B}\right)}{2K\,\tan\phi}
\left[1-\exp\!\left(-\frac{2K\,H}{\alpha B}\,\tan\phi\right)\right] }
\]

- ここで **$H$ は土被り**（$H_f$ は切羽高さ）。
- **深部条件**（便宜上 $H>1.5B$）では角括弧は $1$ と近似し、
  \(\displaystyle q=\frac{\alpha B(\gamma-2c/(\alpha B))}{2K\tan\phi}\).

- **深部前提**（\(C\to\infty\)）では角括弧 \([\;]\to 1\) となり、
  \(\displaystyle q=\dfrac{B_{\mathrm{eff}}(\gamma - c/B_{\mathrm{eff}})}{2K\,\tan\phi}\)。

### 4.3 自重の等価合力 \(W_f\)（1 m 幅当たり）
\[
W_f \;=\; \gamma\!\left(\frac{H_f\,B}{2} + \frac{r_d^2 - r_0^2}{4\,\tan\phi} - \frac{r_0\,r_d\,\sin\theta_d}{2}\right).
\]

### 4.4 自重の作用点 \(l_w\)
- 三角形部（\(w_1,l_{w1}\)）と曲線領域（\(w_2,l_{w2}\)）を合成：
\[
l_w \;=\; \frac{w_1\,l_{w1} + w_2\,l_{w2}}{w_1 + w_2}.
\]

#### 分岐なし実装による統一的な計算式
曲線部分の重心 \(l_{w2}\) は以下の統一式で計算：
\[
l_{w2} = S\cos(\phi + T) + \frac{2}{3} \cdot \frac{U}{1-\cos V} \cdot \frac{1-\cos^2 V}{V-\sin V \cos V} \cdot \sin V \cdot \cos\left(\arctan\frac{B}{H_f}\right) - \frac{U\cos V}{1-\cos V} \cdot \cos\left(\arctan\frac{B}{H_f}\right)
\]

ここで、中間パラメータは以下のように定義：
- \(O = \sqrt{B^2 + H_f^2}\)（切羽の対角線長）
- \(P = \arctan(H_f/B)\)（方向角）
- \(S = \sqrt{O^2/4 + r_0^2 - O r_0 \cos(P + \phi)}\)
- \(T = \arccos(r_0 \sin(P + \phi) / S) - (P + \phi - \pi/2)\)
- \(U = (r_0 e^{T\tan\phi} - S) \cdot r_0 \sin(P + \phi) / S\)
- \(V = \pi - 2\arctan(O/(2U))\)

---

## 5. 粘着の抵抗モーメント（閉形式）
\[
\boxed{ \; M_c \;=\; \frac{c\,\bigl(r_d^2 - r_0^2\bigr)}{2\,\tan\phi} \; }
\]

---

## 6. 支保圧の算定（モーメント釣合い）
\[
\boxed{
P \;=\; \frac{W_f\,l_w \;+\; q\,B\,\Bigl(l_a + \tfrac{B}{2}\Bigr) \;-\; M_c}{\,l_p\,}
}
\]

- \(\theta_d\) を掃引して \(P\) を評価し、**最大値を必要支保圧**とする。

---

## 7. 設計注記（文言として設計書へ記載）

- **係数 0.9 の意味**：上載荷重の等価合力算定で用いる係数 **0.9 は \(\alpha/2\)** に相当し、
  \(\alpha\) は**実験的知見**から一般に **\(\alpha\simeq 1.8\)** が適当とされる。
- **分母の \(\tan\phi\) の厳密形**：\(/\tan\phi\) は正確には **\(/\,(2K\tan\phi)\)** とする。
  **Terzaghi の実験**によれば **\(K=1\sim1.5\)** の範囲が報告され、
  **一般には \(K=1\)** を用いる。
- **深部前提**と**有限被り**：深部前提の設計書式（\(C\) の入力なし）では上式の角括弧を 1 とみなす。
  浅被りでは有限被り式を適用するか、上限解析・数値解析との併用で安全側を採用する。

---

## 8. 計算フロー（実装指針）

1. 入力 \((H,\gamma,c,\phi,C,\alpha,K)\) と \(\theta_d\) の掃引範囲を設定。
2. 各 \(\theta_d\) について 3章の**幾何の閉合**から \((r_0,r_d,l_a,B,l_p)\) を算出。
3. 4章の式で \(B_{\mathrm{eff}},q,W_f,l_w\) を算出。
4. 5章の式で \(M_c\) を算出。
5. 6章の式で \(P\) を算出。
6. すべての \(\theta_d\) のうち **\(P\) 最大**を採択。出力に \(\theta_d^\*\) と幾何を付記。
7. **深部⇔有限被り**は \(C\) の有無または閾値で自動切替（角括弧→1）。

---

## 9. 旧版からの主な差分と最新の改良

### 旧版からの差分
- 入力から **r₀ を削除**し、**内部で幾何閉合**から決定。
- **支保圧の腕**を \(l_p=r_0\sin\phi+H_f/2\) に統一。
- **粘着抵抗モーメント**を **閉形式** \(c(r_d^2-r_0^2)/(2\tan\phi)\) に統一。
- **上載合力**に **\(\alpha\) と \(K\)** を導入（0.9=\(\alpha/2\)、\(/\tan\phi\to/\,(2K\tan\phi)\)）。
- **有限土被り \(H\)** を明示的に扱う式へ一般化（深部は角括弧→1）。

### 最新の改良（分岐なし実装）
- **条件分岐の削除**：\(l_{w2}\) 計算における全ての条件分岐を削除し、統一的な計算式を採用。
- **数値的安定性の向上**：分岐なし実装により、パラメータの境界値付近での不連続性を排除。
- **計算の予測可能性**：単一の計算フローにより、デバッグと検証が容易に。
- **方向余弦の統一**：常に \(\cos(\arctan(B/H_f))\) を使用することで一貫性を確保。

---

## 10. 検証・留意事項

- 数式・単位の整合（\(\gamma\) は **kN/m³**、\(c\) は **kPa**）。
- 係数 \(\alpha,K\) の感度分析（標準 \(\alpha=1.8,\;K=1\)）。
- 既存 Excel 実装（起点側シート）と同パラメータで**有限被り因子→1**にすれば**完全一致**することをユニットテストで確認可能。
- 浅被り・高水圧など、モデル外要因が支配的な場合は**他手法**との併用が必須。
- 分岐なし実装により、\(V \approx \pi\) または \(1-\cos V \approx 0\) の極限値でも数値的に安定した計算が可能。
- **デフォルト設定**：force_finite_cover = True（有限土被り式を標準使用）。

---

（以上）
